# API для блога на Django Rest Framework

Приложение доступно по адресу: http://138.68.72.216:8000/api/schema/swagger/

Проект представляет собой блог с API, реализованным на Django. API позволяет пользователям создавать и редактировать посты, оставлять комментарии, а также ставить лайки и дизлайки. Для хранения данных используется PostgreSQL, а для отслеживания популярных постов — Redis.

## API реализовано в двух версиях

**Версия 1**: Использует обработчики, унаследованные от ModelViewSet из DRF, для более стандартного подхода к CRUD операциям.

**Версия 2**: Реализует обработчики через классы из модуля generics (например, ListCreateAPIView, RetrieveUpdateDestroyAPIView), что позволяет более гибко контролировать логику обработки запросов.

## Основные возможности

- **Авторизация и аутентификация**: JWT через Django Rest Framework.
- **Посты**: Создание, редактирование и комментирование постов для авторизованных пользователей.
- **Лайки и дизлайки**: Реализована система лайков и дизлайков с подсчетом через Django сигналы. Количество лайков и дизлайков обновляется автоматически при изменении данных.
- **Поиск**: Поиск постов через триграммы с использованием PostgreSQL.
- **Комментарии**: Возможность оставлять комментарии для авторизованных пользователей, редактирование — для администраторов.
- **Права доступа**: Использование встроенных и кастомных классов прав доступа для управления доступом к постам и комментариям на основе роли пользователя.
- **Документация API**: Автоматически генерируемая документация через Swagger UI, с использованием DRF Spectacular.

## Особенности

- Для поиска постов используется PostgreSQL с расширением PG_TRGM для триграмм.
- Популярные посты хранятся в Redis.
- Для деплоя настроены процессы CI/CD через GitHub Actions.
- Приложение развернуто на VPS, хостящемся на DigitalOcean, с использованием Docker Compose.

## Технологии

- **Django** - веб фреймворк.
- **Django Rest Framework (DRF)** - Для создания RESTful API.
- **DRF Spectacular** - Для автоматической генерации документации OpenAPI.
- **PostgreSQL** - база данных.
- **Redis** - для хранения популярных постов.
- **Docker/Docker Compose** - контейнеризация и развертывание.
- **CI/CD** - автоматизация деплоя через GitHub Actions.
- **Nginx** - для проксирования запросов.

## Установка и запуск

1. Клонировать репозиторий:
    ```bash
    git clone https://github.com/asrglv/blog.git
    cd blog
    ```
2. Создать файлы переменных окружения:
	```bash
	blog.env

	SECRET_KEY=secret_key
	DEBUG=False
	DB_NAME=blog-db
	DB_USER=user
	DB_PASSWORD=password
	DB_HOST=database
	DB_PORT=5432
	REDIS_URL=redis://redis:6379/0
	```
	```bash
	db.env

	POSTGRES_DB=blog-db
	POSTGRES_USER=user
	POSTGRES_PASSWORD=password
	```
	```bash
	nginx.env

	BACKEND_HOST=http://backend:8000
	```
3. Запустить проект с использованием Docker:
    ```bash
    docker-compose up --build
    ```

## CI/CD

Процесс CI/CD настроен с использованием GitHub Actions и включает несколько workflow файлов, каждый из которых выполняет свою задачу в зависимости от событий:

**1. CI Workflow** (ci.yml):
Этот workflow запускается при каждом push в репозиторий, автоматически проверяя корректность сборки Docker контейнеров и конфигураций с помощью docker-compose.test.yml.

**2. CD Workflow** (cd.yml):
Этот workflow запускается вручную с помощью workflow_dispatch, что позволяет инициировать деплой на сервер по запросу.

**3. CI/CD Workflow** (ci-cd.yml):
Этот workflow также использует workflow_dispatch, и выполняет как корректность сборки, так и деплой в одном процессе.

**4. Первоначальный деплой** (first-deploy.yml):
Этот workflow запускается вручную через workflow_dispatch и используется для первоначальной настройки и деплоя приложения на сервер.